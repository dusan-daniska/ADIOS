<?php

namespace ADIOS\Widgets\{{ thisWidget.name }}\Models;

class {{ thisModel.name }} extends \ADIOS\Core\Model {
  var $sqlName = "{{ thisModel.config.sqlName }}";
  var $urlBase = "{{ thisModel.config.urlBase }}";
  var $tableTitle = "{{ thisModel.config.tableTitle }}";
  var $formTitleForInserting = "{{ thisModel.config.formTitleForInserting }}";
  var $formTitleForEditing = "{{ thisModel.config.formTitleForEditing }}";
  var $lookupSqlValue = "{{ thisModel.config.lookupSqlValue }}";

  public function columns($columns = []) {
    return parent::columns([
{% for colName, colDefinition in thisModel.config.columns %}
      "{{ colName }}" => json_decode('{{ colDefinition|json_encode|raw }}', TRUE),
{% endfor %}
    ]);
  }

{% if (thisModel.config.formParams) %}
  public function formParams($data, $params) {
    $id = (int) $data["id"];

    if ($id <= 0) {
      $params["template"] = {{ varExport(thisModel.config.formParams.templateForInserting) }};
    } else {
      $params["template"] = {{ varExport(thisModel.config.formParams.templateForEditing) }};
    }

    $params["default_values"] = {{ varExport(thisModel.config.formParams.defaultValues) }};

    return $this->adios->dispatchEventToPlugins("onModelAfterFormParams", [
      "model" => $this,
      "data" => $data,
      "params" => $params,
    ])["params"];

  }
{% endif %}
}
